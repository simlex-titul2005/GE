@model SxVMSiteTestAnswer
@{
    Layout = null;
    var oldSteps = (SxVMSiteTestStepNormal[])ViewBag.OldSteps;
    var allSubjectsCount = Convert.ToInt32(ViewBag.AllSubjectsCount ?? -1);
    SxVMSiteTestStepNormal step;
}

@if (allSubjectsCount > oldSteps.Length - 1 || allSubjectsCount == -1)
{
    using (Ajax.BeginForm("StepNormal", new { controller = "SiteTests" }, new AjaxOptions { HttpMethod = "post", UpdateTargetId = "st-page", OnComplete = "setStepInterval" }, new { @autocomplete = "off" }))
    {
        <br />
        <blockquote>
            @Html.Raw(Model.Question.Test.Description)
        </blockquote>

        @Html.AntiForgeryToken()

        <ul class="s" style="display:none;">
            @for (int i = 0; i < oldSteps.Length; i++)
            {
                step = oldSteps[i];
                <li class="s-s">
                    <input type="hidden" name="[@i].SubjectId" value="@step.SubjectId" />
                    @if (step.QuestionId != 0)
                    {
                        <input type="hidden" name="[@i].QuestionId" value="@step.QuestionId" />
                    }
                    <input type="hidden" name="[@i].LettersCount" value="@step.LettersCount" />
                    <input type="hidden" name="[@i].BallsSubjectShow" value="@step.BallsSubjectShow" />
                    <input type="hidden" name="[@i].BallsGoodRead" value="@step.BallsGoodRead" />
                    <input type="hidden" name="[@i].BallsBadRead" value="@step.BallsBadRead" />
                </li>
            }
        </ul>

        <h2 data-subject-id="@Model.Subject.Id"><img style="height:80px; margin-right:30px;" alt="@Model.Subject.Title" src="@(Model.Subject.PictureId.HasValue?Url.Action("Picture","Pictures", new { id=Model.Subject.PictureId}):"/content/dist/i/testsubject.png")" /> @Model.Subject.Title</h2>

        if (Model.Question.Test.Questions.Any())
        {
            SxVMSiteTestQuestion question;
            <ul class="test-normal-q-list">
                @for (int i = 0; i < Model.Question.Test.Questions.Length; i++)
                {
                    question = Model.Question.Test.Questions[i];
                    <li>
                        <input type="radio" id="q-@question.Id" name="question" /> <label for="q-@question.Id">@question.Text</label>
                    </li>
                }
            </ul>
        }
        <div class="text-center">
            <button type="submit" class="btn btn-transparent white test-normal-q-list__dont-btn">Пропустить</button>
        </div>
    }
}
else
{
    <script>
        continueStep = false;
    </script>
    using (Ajax.BeginForm("NormalResults", "SiteTests", new AjaxOptions { OnSuccess="fillNormalResults" }))
    {
        @Html.AntiForgeryToken()
        <ul class="s" style="display:none;">
            @for (int i = 0; i < oldSteps.Length; i++)
            {
                step = oldSteps[i];
                <li class="s-s">
                    <input type="hidden" name="[@i].SubjectId" value="@step.SubjectId" />
                    @if (step.QuestionId != 0)
                    {
                        <input type="hidden" name="[@i].QuestionId" value="@step.QuestionId" />
                    }
                    <input type="hidden" name="[@i].LettersCount" value="@step.LettersCount" />
                    <input type="hidden" name="[@i].BallsSubjectShow" value="@step.BallsSubjectShow" />
                    <input type="hidden" name="[@i].BallsGoodRead" value="@step.BallsGoodRead" />
                    <input type="hidden" name="[@i].BallsBadRead" value="@step.BallsBadRead" />
                </li>
            }
        </ul>
        <br />
        <blockquote>
            @Html.Raw(Model.Question.Test.Description)
        </blockquote>

        <h2>Тест пройден</h2>
        <br />
        <div class="text-center">
            <a class="btn btn-transparent white" href="@Url.Action("Details", "SiteTests", new { titleUrl = Model.Question.Test.TitleUrl })">Пройти заново</a>
            <button class="btn btn-transparent white" type="submit">Получить результаты</button>
        </div>
        <br />
    }
}